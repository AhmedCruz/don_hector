<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a Interactiva Don H√©ctor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fcfbf9; color: #2d3748; }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 300px; max-height: 400px; }
        @media (min-width: 768px) { .chart-container { height: 350px; } }
        .active-nav { background-color: #e2e8f0; border-left: 4px solid #4a5568; font-weight: 600; }
        .tab-btn.active { border-bottom: 2px solid #4a5568; color: #1a202c; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Custom gradient for new features */
        .bg-gradient-new { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
    </style>
</head>
<body class="h-screen flex flex-col md:flex-row overflow-hidden">

    <!-- Mobile Header -->
    <div class="md:hidden bg-white shadow-sm p-4 flex justify-between items-center z-10">
        <h1 class="text-xl font-bold text-gray-800">Don H√©ctor Guide</h1>
        <button id="mobile-menu-btn" class="text-gray-600 focus:outline-none text-2xl">‚ò∞</button>
    </div>

    <!-- Sidebar Navigation -->
    <nav id="sidebar" class="bg-white border-r border-gray-200 w-full md:w-64 flex-shrink-0 absolute md:relative z-20 transform -translate-x-full md:translate-x-0 transition-transform duration-300 h-full overflow-y-auto">
        <div class="p-6 hidden md:block">
            <h1 class="text-2xl font-bold text-gray-800 tracking-tight">Don H√©ctor</h1>
            <p class="text-xs text-gray-500 mt-1 uppercase tracking-wider">Manual de Usuario</p>
        </div>
        
        <div class="mt-4">
            <a href="#" class="nav-item active-nav block px-6 py-4 text-gray-700 hover:bg-gray-50 transition-colors" data-section="overview">
                <span class="block text-sm">Inicio</span>
                <span class="block font-medium">Visi√≥n General</span>
            </a>
            <a href="#" class="nav-item block px-6 py-4 text-gray-700 hover:bg-gray-50 transition-colors" data-section="file1">
                <span class="block text-sm">Archivo 1</span>
                <span class="block font-medium">Cat√°logo Maestro</span>
            </a>
            <a href="#" class="nav-item block px-6 py-4 text-gray-700 hover:bg-gray-50 transition-colors" data-section="file2">
                <span class="block text-sm">Archivo 2</span>
                <span class="block font-medium">Base XMLs</span>
            </a>
            <a href="#" class="nav-item block px-6 py-4 text-gray-700 hover:bg-gray-50 transition-colors" data-section="file3">
                <span class="block text-sm text-green-600 font-bold">Archivo 3 (CR√çTICO)</span>
                <span class="block font-medium">Estado de Cuenta</span>
            </a>
            <a href="#" class="nav-item block px-6 py-4 text-gray-700 hover:bg-gray-50 transition-colors" data-section="predictions">
                <span class="block text-sm text-indigo-600 font-bold">Motor de IA</span>
                <span class="block font-medium">Asignaci√≥n y Predicci√≥n</span>
            </a>
            <a href="#" class="nav-item block px-6 py-4 text-gray-700 hover:bg-gray-50 transition-colors" data-section="process">
                <span class="block text-sm">Flujo</span>
                <span class="block font-medium">Resumen del Proceso</span>
            </a>
        </div>
        
        <div class="p-6 mt-auto">
            <div class="bg-gray-100 rounded-lg p-4">
                <p class="text-xs text-gray-500 mb-2">Estado del Sistema</p>
                <div class="flex items-center">
                    <span class="h-2 w-2 rounded-full bg-green-500 mr-2"></span>
                    <span class="text-sm font-semibold text-gray-700">Conciliador IA v2.0 Activo</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-1 overflow-y-auto bg-[#fcfbf9] relative w-full">
        <div class="max-w-5xl mx-auto p-6 md:p-10 pb-20">
            
            <!-- SECTION: OVERVIEW -->
            <section id="overview" class="section-content fade-in">
                <header class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800">Bienvenido a Don H√©ctor</h2>
                    <p class="text-gray-600 mt-2 text-lg">Sistema de conciliaci√≥n autom√°tica y generaci√≥n de p√≥lizas mediante Inteligencia Artificial.</p>
                </header>

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-8 mb-8">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">Requisitos Cr√≠ticos</h3>
                    <p class="mb-6 text-gray-600">Para asegurar el correcto funcionamiento del sistema h√≠brido, prepare estos 3 componentes. La IA cruzar√° todo autom√°ticamente.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-orange-50 rounded-lg p-6 border border-orange-100 hover:shadow-md transition-shadow cursor-pointer" onclick="navigateTo('file1')">
                            <div class="text-orange-600 font-bold text-lg mb-2">01. Cat√°logo</div>
                            <p class="text-sm text-gray-700">Entrenamiento de la IA. Define cuentas, proveedores y bancos.</p>
                            <span class="inline-block mt-3 text-xs font-semibold bg-white px-2 py-1 rounded border border-orange-200 text-orange-800">BD Postgres / CSV</span>
                        </div>
                        <div class="bg-blue-50 rounded-lg p-6 border border-blue-100 hover:shadow-md transition-shadow cursor-pointer" onclick="navigateTo('file2')">
                            <div class="text-blue-600 font-bold text-lg mb-2">02. Base XMLs</div>
                            <p class="text-sm text-gray-700">Fuente de datos fiscales y UUIDs extra√≠dos de la base de datos.</p>
                            <span class="inline-block mt-3 text-xs font-semibold bg-white px-2 py-1 rounded border border-blue-200 text-blue-800">BD Postgres / Excel</span>
                        </div>
                        <div class="bg-green-50 rounded-lg p-6 border-2 border-green-500 shadow-md hover:shadow-lg transition-shadow cursor-pointer relative" onclick="navigateTo('file3')">
                            <div class="absolute -top-3 -right-3 bg-green-500 text-white text-[10px] font-bold px-2 py-1 rounded-full uppercase tracking-wide">Actualizado</div>
                            <div class="text-green-600 font-bold text-lg mb-2">03. Estado de Cuenta</div>
                            <p class="text-sm text-gray-700">Input principal. Movimientos bancarios en bruto.</p>
                            <span class="inline-block mt-3 text-xs font-semibold bg-white px-2 py-1 rounded border border-green-200 text-green-800">Formato: Excel</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                        <h3 class="font-semibold text-gray-800 mb-4">¬øC√≥mo funciona la IA de Conciliaci√≥n?</h3>
                        <ul class="space-y-3">
                            <li class="flex items-start">
                                <span class="flex-shrink-0 h-6 w-6 flex items-center justify-center rounded-full bg-green-100 text-green-600 font-bold text-xs mr-3">1</span>
                                <span class="text-sm text-gray-600">Busca el <strong>importe exacto</strong> (Cargo del Banco vs Total del XML).</span>
                            </li>
                            <li class="flex items-start">
                                <span class="flex-shrink-0 h-6 w-6 flex items-center justify-center rounded-full bg-green-100 text-green-600 font-bold text-xs mr-3">2</span>
                                <span class="text-sm text-gray-600">Busca el <strong>RFC dentro del concepto</strong> del banco (Bonificaci√≥n por match).</span>
                            </li>
                            <li class="flex items-start">
                                <span class="flex-shrink-0 h-6 w-6 flex items-center justify-center rounded-full bg-green-100 text-green-600 font-bold text-xs mr-3">3</span>
                                <span class="text-sm text-gray-600">Utiliza Procesamiento de Lenguaje (NLP) para emparejar la descripci√≥n bancaria con la raz√≥n social.</span>
                            </li>
                        </ul>
                    </div>
                    <div class="bg-gray-800 text-white p-6 rounded-xl shadow-lg flex flex-col justify-center items-center text-center">
                        <h3 class="font-bold text-xl mb-2">Configure su Estado de Cuenta</h3>
                        <p class="text-gray-400 text-sm mb-6">El sistema se ha actualizado. Revise las nuevas columnas obligatorias.</p>
                        <button onclick="navigateTo('file3')" class="px-6 py-2 bg-green-500 text-white font-bold rounded-full hover:bg-green-400 transition-colors shadow-lg transform hover:scale-105 duration-200">
                            Ver Archivo 3 Cr√≠tico &rarr;
                        </button>
                    </div>
                </div>
            </section>

            <!-- SECTION: FILE 1 -->
            <section id="file1" class="section-content hidden fade-in">
                <header class="mb-6 border-b border-gray-200 pb-4">
                    <div class="flex items-center text-sm text-gray-500 mb-2">
                        <span>Archivos Requeridos</span>
                        <span class="mx-2">/</span>
                        <span class="font-semibold text-orange-600">Archivo 1</span>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-800">Cat√°logo de Cuentas (Maestro)</h2>
                    <p class="text-gray-600 mt-2">El cerebro del sistema.</p>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Left: Interactive Viz -->
                    <div class="lg:col-span-1 bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                        <h3 class="font-semibold text-gray-800 mb-4 text-center">Composici√≥n Requerida</h3>
                        <div class="chart-container">
                            <canvas id="chartFile1"></canvas>
                        </div>
                    </div>

                    <!-- Right: Content -->
                    <div class="lg:col-span-2 space-y-6">
                        <div class="bg-orange-50 border-l-4 border-orange-500 p-4 rounded-r-lg">
                            <p class="text-sm text-orange-900">
                                <strong>Nota Importante:</strong> El sistema limpiar√° espacios y acentos, pero los n√∫meros de cuenta deben mantener estrictamente su estructura de guiones.
                            </p>
                        </div>

                        <!-- Requirements List (Filtered by Chart) -->
                        <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
                            <h3 class="font-semibold text-gray-800 mb-3">Detalle por Tipo de Cuenta</h3>
                            <div class="space-y-3">
                                <div class="p-3 rounded bg-gray-50 border-l-4 border-indigo-400">
                                    <span class="text-xs font-bold text-indigo-600 uppercase block mb-1">Serie 6000 (Gastos)</span>
                                    <p class="text-sm">Debe incluir cuentas Padre (terminan en -000) y Subcuentas. Se usa para predicciones L√©xicas y Sem√°nticas (Bottom-Up).</p>
                                </div>
                                <div class="p-3 rounded bg-gray-50 border-l-4 border-emerald-400">
                                    <span class="text-xs font-bold text-emerald-600 uppercase block mb-1">Serie 2110/2114 (Proveedores)</span>
                                    <p class="text-sm">Necesario para identificar la Raz√≥n Social y crear el pasivo correspondiente.</p>
                                </div>
                                <div class="p-3 rounded bg-gray-50 border-l-4 border-amber-400">
                                    <span class="text-xs font-bold text-amber-600 uppercase block mb-1">Serie 1120 (Bancos)</span>
                                    <p class="text-sm">Identifica el origen de los fondos. Reconoce autom√°ticamente en base al NLP.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION: FILE 2 -->
            <section id="file2" class="section-content hidden fade-in">
                <header class="mb-6 border-b border-gray-200 pb-4">
                    <div class="flex items-center text-sm text-gray-500 mb-2">
                        <span>Archivos Requeridos</span>
                        <span class="mx-2">/</span>
                        <span class="font-semibold text-blue-600">Archivo 2</span>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-800">Base de Datos de Facturas (XMLs)</h2>
                    <p class="text-gray-600 mt-2">Extra√≠da autom√°ticamente de la base de datos (Postgres).</p>
                </header>

                <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm mb-8">
                    <h3 class="font-semibold text-gray-800 mb-4">¬øQu√© hace el sistema con los XMLs?</h3>
                    <p class="text-sm text-gray-600 mb-4">Se extraen autom√°ticamente de la Base de Datos seg√∫n el RFC y el rango de fechas proporcionado en la plataforma. Internamente, el sistema asegura la presencia de:</p>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <span class="block text-xl font-bold text-blue-700">UUID</span>
                            <span class="text-xs text-blue-600">Primeros 8 chars</span>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <span class="block text-xl font-bold text-blue-700">RFC / Nombre</span>
                            <span class="text-xs text-blue-600">Del Emisor</span>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <span class="block text-xl font-bold text-blue-700">Montos</span>
                            <span class="text-xs text-blue-600">Sub, IVA, Total</span>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <span class="block text-xl font-bold text-blue-700">Clave SAT</span>
                            <span class="text-xs text-blue-600">ClaveProdServ</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION: FILE 3 (CRITICAL) -->
            <section id="file3" class="section-content hidden fade-in">
                <header class="mb-6 border-b border-gray-200 pb-4">
                    <div class="flex items-center text-sm text-gray-500 mb-2">
                        <span>Archivos Requeridos</span>
                        <span class="mx-2">/</span>
                        <span class="font-semibold text-green-600">Archivo 3 (Estado de Cuenta)</span>
                    </div>
                    <div class="flex flex-col md:flex-row md:justify-between md:items-end">
                        <div>
                            <h2 class="text-3xl font-bold text-gray-800">Estado de Cuenta Bancario</h2>
                            <p class="text-gray-600 mt-2">El archivo que usted carga. Formato requerido: <strong>Excel (.xlsx)</strong></p>
                        </div>
                    </div>
                </header>

                <!-- NEW ALGORITHM BANNER -->
                <div class="mb-6 bg-gradient-new text-white p-5 rounded-xl shadow-md flex items-start">
                    <div class="flex-shrink-0 text-white mr-4 mt-1">
                        <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    </div>
                    <div>
                        <h4 class="text-lg font-bold">¬°NUEVO! Motor de Conciliaci√≥n Autom√°tica</h4>
                        <p class="text-sm mt-1 text-green-50 opacity-90 leading-relaxed">
                            Ya <strong>no es obligatorio</strong> escribir manualmente el UUID, el EGRESO ni la Cuenta Mayor. El sistema lee el estado de cuenta puro que le da el banco y mediante el algoritmo cruzar√° autom√°ticamente las fechas, montos e intentar√° extraer el RFC de la <strong>Descripci√≥n</strong>.
                        </p>
                    </div>
                </div>

                <!-- Sheet Name Warning -->
                <div class="mb-6 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg flex items-start">
                    <div class="flex-shrink-0 text-yellow-500 mr-3">
                        <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/></svg>
                    </div>
                    <div>
                        <h4 class="text-sm font-bold text-yellow-800">Nombre de las Pesta√±as (Hojas)</h4>
                        <p class="text-sm text-yellow-700 mt-1">
                            El nombre de cada hoja de c√°lculo <strong>debe corresponder al Banco</strong> origen de los movimientos. Evite espacios extra√±os.<br>
                            <span class="font-mono text-xs bg-yellow-100 px-2 py-1 rounded font-bold mt-2 inline-block">Ejemplos: "BBVA", "BAJIO", "SANTANDER"</span>
                        </p>
                    </div>
                </div>

                <div id="mode-desc" class="mb-6 text-sm font-medium text-gray-700 bg-white p-4 rounded-lg border border-gray-200">
                    <!-- Dynamic Text injected by JS -->
                </div>

                <!-- Columns Section -->
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden relative">
                    <div class="absolute top-0 left-0 w-2 h-full bg-green-500"></div>
                    
                    <div class="p-6 pl-8">
                        <h3 class="font-bold text-gray-800 mb-6 flex items-center text-xl">
                            <span class="uppercase tracking-wide text-green-700">Columnas Indispensables para la Lectura</span>
                        </h3>
                        
                        <div id="file3-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Cards injected by JS -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION: PREDICTIONS (IA MOTOR) -->
            <section id="predictions" class="section-content hidden fade-in">
                <header class="mb-8 border-b border-gray-200 pb-4">
                    <div class="flex items-center text-sm text-gray-500 mb-2">
                        <span>Motor de IA</span>
                        <span class="mx-2">/</span>
                        <span class="font-semibold text-indigo-600">Asignaci√≥n y Predicci√≥n</span>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-800">El Cerebro del Sistema</h2>
                    <p class="text-gray-600 mt-2">Descubra c√≥mo la inteligencia artificial toma decisiones precisas de conciliaci√≥n y contabilidad mediante modelos matem√°ticos y sem√°nticos.</p>
                </header>

                <!-- Part 1: Algoritmo H√∫ngaro -->
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden mb-8">
                    <div class="bg-indigo-600 p-4 text-white flex items-center">
                        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                        <h3 class="text-xl font-bold">1. Asignaci√≥n Global (Algoritmo H√∫ngaro)</h3>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-600 mb-6">El sistema no empareja el primer registro que encuentra. En su lugar, construye una matriz de costos y eval√∫a todas las combinaciones posibles de facturas y movimientos bancarios <strong>simult√°neamente</strong> para encontrar la asignaci√≥n 1-a-1 perfecta a nivel global.</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="bg-indigo-50 rounded-lg p-5 border border-indigo-100">
                                <div class="text-indigo-700 font-bold mb-2 flex items-center"><span class="text-xl mr-2">üí∏</span> Costo por Monto</div>
                                <p class="text-sm text-gray-700">Calcula la diferencia exacta en centavos entre el cargo bancario y el total del XML. Solo pre-selecciona candidatos si la diferencia es menor a la tolerancia permitida (ej. $0.50 MXN).</p>
                            </div>
                            <div class="bg-indigo-50 rounded-lg p-5 border border-indigo-100">
                                <div class="text-indigo-700 font-bold mb-2 flex items-center"><span class="text-xl mr-2">üìÖ</span> Costo por Fecha</div>
                                <p class="text-sm text-gray-700">Penaliza la asignaci√≥n matem√°tica si la fecha de la factura y la del cobro bancario est√°n alejadas en d√≠as. Ayuda a desempatar cobros id√©nticos.</p>
                            </div>
                            <div class="bg-indigo-50 rounded-lg p-5 border border-indigo-100">
                                <div class="text-indigo-700 font-bold mb-2 flex items-center"><span class="text-xl mr-2">üî§</span> Bonificaci√≥n RFC</div>
                                <p class="text-sm text-gray-700">Si el RFC del XML aparece escrito dentro del concepto bancario, el sistema otorga un "descuento de costo" forzando un emparejamiento casi 100% seguro.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Part 2: Predicci√≥n Bottom-Up -->
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden">
                    <div class="bg-emerald-600 p-4 text-white flex items-center">
                        <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                        <h3 class="text-xl font-bold">2. Estrategia de Predicci√≥n (Bottom-Up)</h3>
                    </div>
                    <div class="p-6">
                        <p class="text-gray-600 mb-6">En lugar de intentar adivinar la cuenta de mayor directamente, la IA utiliza una estrategia de "abajo hacia arriba" (Bottom-Up) deduciendo primero el gasto m√°s espec√≠fico.</p>

                        <div class="flex flex-col md:flex-row gap-4 items-stretch">
                            <!-- Paso A -->
                            <div class="flex-1 bg-gray-50 rounded-lg p-5 border border-gray-200">
                                <h4 class="font-bold text-gray-800 mb-3 border-b pb-2 text-sm">A. Fusi√≥n de Contexto</h4>
                                <ul class="text-sm text-gray-700 space-y-2">
                                    <li><span class="text-emerald-500 font-bold">+</span> Concepto Bancario</li>
                                    <li><span class="text-emerald-500 font-bold">+</span> Concepto Factura (XML)</li>
                                    <li><span class="text-emerald-500 font-bold">+</span> Desc. Clave SAT</li>
                                </ul>
                                <p class="text-xs text-gray-500 mt-3 italic">Se crea un "s√∫per-texto" agrupando la informaci√≥n disponible.</p>
                            </div>
                            
                            <!-- Arrow -->
                            <div class="flex flex-col justify-center items-center text-gray-400">
                                <svg class="w-6 h-6 transform rotate-90 md:rotate-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                            </div>

                            <!-- Paso B -->
                            <div class="flex-1 bg-gray-50 rounded-lg p-5 border border-gray-200">
                                <h4 class="font-bold text-gray-800 mb-3 border-b pb-2 text-sm">B. Clasificaci√≥n Dual (Hija)</h4>
                                <ul class="text-sm text-gray-700 space-y-3">
                                    <li><strong>1. L√©xico (TF-IDF):</strong> Busca patrones exactos de caracteres (Ej. "Gasolina" ‚Üí "Combustibles").</li>
                                    <li><strong>2. Sem√°ntico (IA):</strong> Si las palabras no coinciden, entiende el contexto (Ej. "Uber" ‚Üí "Transporte").</li>
                                </ul>
                            </div>

                            <!-- Arrow -->
                            <div class="flex flex-col justify-center items-center text-gray-400">
                                <svg class="w-6 h-6 transform rotate-90 md:rotate-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                            </div>

                            <!-- Paso C -->
                            <div class="flex-1 bg-emerald-50 rounded-lg p-5 border border-emerald-200 shadow-sm relative overflow-hidden">
                                <div class="absolute right-0 top-0 opacity-10">
                                    <svg class="w-24 h-24" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                                </div>
                                <h4 class="font-bold text-emerald-800 mb-3 border-b border-emerald-200 pb-2 text-sm">C. Deducci√≥n Padre</h4>
                                <p class="text-sm text-gray-700">Al encontrar la <strong>Subcuenta</strong> ganadora de forma precisa, el sistema mapea e infiere infaliblemente a qu√© <strong>Cuenta Mayor</strong> pertenece, seg√∫n la estructura jer√°rquica dictada en su Archivo 1.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION: PROCESS -->
            <section id="process" class="section-content hidden fade-in">
                <header class="mb-8 text-center max-w-2xl mx-auto">
                    <h2 class="text-3xl font-bold text-gray-800">Flujo de Conciliaci√≥n y P√≥lizas</h2>
                    <p class="text-gray-600 mt-2">C√≥mo interact√∫a la IA con sus datos.</p>
                </header>

                <div class="relative max-w-4xl mx-auto">
                    <!-- Connecting Line -->
                    <div class="absolute left-1/2 top-0 bottom-0 w-1 bg-gray-200 transform -translate-x-1/2 hidden md:block"></div>

                    <!-- Step 1 -->
                    <div class="relative z-10 flex flex-col md:flex-row items-center mb-12">
                        <div class="w-full md:w-1/2 md:pr-8 md:text-right">
                            <h3 class="text-lg font-bold text-gray-800">1. Extracci√≥n de DB (Base XML)</h3>
                            <p class="text-sm text-gray-600">El sistema se conecta y extrae todas las facturas de su empresa en el rango de fechas.</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold border-4 border-white shadow-lg my-4 md:my-0 text-xl z-10">1</div>
                        <div class="w-full md:w-1/2 md:pl-8"></div>
                    </div>

                    <!-- Step 2 -->
                    <div class="relative z-10 flex flex-col md:flex-row items-center mb-12">
                        <div class="w-full md:w-1/2 md:pr-8 md:text-right hidden md:block"></div>
                        <div class="w-12 h-12 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold border-4 border-white shadow-lg my-4 md:my-0 text-xl z-10">2</div>
                        <div class="w-full md:w-1/2 md:pl-8">
                            <h3 class="text-lg font-bold text-gray-800">2. Lectura del Estado de Cuenta</h3>
                            <p class="text-sm text-gray-600">Usted sube el Excel. El sistema identifica las hojas, filtra los cargos reales e ignora filas vac√≠as.</p>
                        </div>
                    </div>

                    <!-- Step 3 -->
                    <div class="relative z-10 flex flex-col md:flex-row items-center mb-12">
                        <div class="w-full md:w-1/2 md:pr-8 md:text-right">
                            <h3 class="text-xl font-bold text-indigo-700">3. Algoritmo H√∫ngaro (Conciliaci√≥n)</h3>
                            <p class="text-sm text-gray-600 mt-2">La IA resuelve las ambig√ºedades construyendo una matriz matem√°tica para encontrar el "match" perfecto considerando <strong>Montos, Fechas y el RFC</strong> en los conceptos.</p>
                        </div>
                        <div class="w-12 h-12 bg-indigo-600 rounded-full flex items-center justify-center text-white font-bold border-4 border-white shadow-lg my-4 md:my-0 text-xl z-10">3</div>
                        <div class="w-full md:w-1/2 md:pl-8"></div>
                    </div>

                    <!-- Step 4 -->
                    <div class="relative z-10 flex flex-col md:flex-row items-center mb-12">
                        <div class="w-full md:w-1/2 md:pr-8 md:text-right hidden md:block"></div>
                        <div class="w-12 h-12 bg-emerald-600 rounded-full flex items-center justify-center text-white font-bold border-4 border-white shadow-lg my-4 md:my-0 text-xl z-10">4</div>
                        <div class="w-full md:w-1/2 md:pl-8">
                            <h3 class="text-xl font-bold text-emerald-700">4. Predicci√≥n Bottom-Up (Hija ‚Üí Padre)</h3>
                            <p class="text-sm text-gray-600 mt-2">Se fusionan los textos del XML y el banco para predecir primero la <strong>Subcuenta espec√≠fica</strong> y autom√°ticamente deducir a qu√© <strong>Cuenta Mayor</strong> pertenece.</p>
                        </div>
                    </div>

                    <!-- Final Output -->
                    <div class="relative z-10 flex justify-center mt-6">
                        <div class="bg-gray-800 text-white px-8 py-5 rounded-xl shadow-xl text-center transform hover:scale-105 transition-transform duration-300 border border-gray-700">
                            <div class="text-3xl mb-2">üìÅ</div>
                            <h3 class="font-bold text-xl">Descarga del Archivo ZIP</h3>
                            <p class="text-sm text-gray-400 mt-1">Obtienes el XML Enriquecido y el EC Conciliado.</p>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <script>
        // --- DATA & CONTENT REFLECTING NEW BACKEND PARSER ---
        const file3Data = {
            desc: "Esta es la estructura CR√çTICA para procesar su archivo Excel (Estado de Cuenta). El sistema rastrear√° los encabezados en la primera fila usando m√∫ltiples sin√≥nimos.",
            columns: [
                { 
                    header: "FECHA / MES", 
                    synonyms: "FECHA OPER, FECHA EMISION, MES, FECHA", 
                    source: "Banco", 
                    desc: "Fecha de la operaci√≥n. Esencial para el Algoritmo H√∫ngaro (penaliza o premia la coincidencia temporal con la fecha del XML)." 
                },
                { 
                    header: "CARGO (Salidas)", 
                    synonyms: "CARGO, CARGOS, DEBE, IMPORTE, RETIRO, RETIROS", 
                    source: "Banco", 
                    desc: "El monto que sali√≥ de la cuenta. El algoritmo lo cruza directamente contra el TOTAL del XML con una tolerancia de centavos." 
                },
                { 
                    header: "ABONO (Entradas)", 
                    synonyms: "ABONOS, ABONO, DEPOSITO, DEPOSITOS", 
                    source: "Banco", 
                    desc: "Entradas de dinero a la cuenta. (Se identifican para separarlas del flujo de egresos habitual)." 
                },
                { 
                    header: "DESCRIPCI√ìN / CONCEPTO", 
                    synonyms: "DESCRIPCION, CONCEPTO, DETALLE, COD. DESCRIPCI√ìN", 
                    source: "Banco", 
                    desc: "¬°VITAL! La IA procesa todo este texto. Si usted pega el RFC del proveedor aqu√≠, el Algoritmo H√∫ngaro asegurar√° el 'Match' casi al 100% de manera autom√°tica." 
                }
            ]
        };

        // --- NAVIGATION LOGIC ---
        function navigateTo(sectionId) {
            document.querySelectorAll('.section-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(sectionId).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('active-nav', 'bg-gray-50');
                if(el.dataset.section === sectionId) {
                    el.classList.add('active-nav');
                }
            });

            const sidebar = document.getElementById('sidebar');
            if (!sidebar.classList.contains('-translate-x-full')) {
                sidebar.classList.add('-translate-x-full');
            }
        }

        // --- FILE 3 INTERACTION ---
        function renderFile3Columns() {
            const data = file3Data;
            document.getElementById('mode-desc').innerHTML = `<strong>Contexto: </strong> ${data.desc}`;
            
            const grid = document.getElementById('file3-grid');
            grid.innerHTML = '';
            
            data.columns.forEach((col, index) => {
                let badgeStyle = col.header.includes("CR√çTICO") || col.header.includes("CARGO") || col.header.includes("DESCRIPCI√ìN") || col.header.includes("FECHA") || col.header.includes("MONTO") || col.header.includes("ID")
                    ? "bg-red-100 text-red-800 border-red-200"
                    : "bg-blue-50 text-blue-800 border-blue-200";

                const card = document.createElement('div');
                card.className = "bg-white p-6 rounded-xl border border-gray-200 shadow-sm hover:shadow-lg transition-all flex flex-col h-full";
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <h4 class="text-lg font-extrabold text-gray-800 tracking-tight">${col.header}</h4>
                        <span class="text-[10px] uppercase font-bold px-2 py-1 rounded border ${badgeStyle} leading-none text-center">
                            Or√≠gen: ${col.source}
                        </span>
                    </div>
                    <p class="text-sm text-gray-600 mb-5 flex-grow font-medium leading-relaxed">${col.desc}</p>
                    <div class="bg-gray-50 rounded-lg p-3 text-xs border border-gray-200 mt-auto">
                        <div class="mb-1"><span class="font-bold text-gray-700 uppercase tracking-wider">Busca en encabezados por:</span></div>
                        <div class="font-mono text-indigo-700 break-words font-semibold bg-indigo-50 p-1 rounded inline-block mt-1">${col.synonyms}</div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // --- MOBILE MENU ---
        document.getElementById('mobile-menu-btn').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('-translate-x-full');
        });

        // --- CHARTS INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderFile3Columns();

            document.querySelectorAll('.nav-item').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateTo(link.dataset.section);
                });
            });

            // Chart 1: Catalog Composition (Donut)
            const ctx1 = document.getElementById('chartFile1').getContext('2d');
            new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['Gastos (6000)', 'Proveedores (2110)', 'Bancos (1120)'],
                    datasets: [{
                        data: [65, 25, 10], 
                        backgroundColor: ['#4f46e5', '#10b981', '#f59e0b'],
                        borderWidth: 0,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, font: { size: 12 } } }
                    }
                }
            });
        });
    </script>
</body>
</html>
